import{u as e,s as a,O as l,r as n,g as t,P as s,Q as c,R as o,f as i,j as r,d as u,T as A,U as f,_ as m,e as g,$ as d,k as v,m as C,w as p,N as y,t as h,n as w,q as k,B as S,C as b,p as N,x,y as Q,z as K,A as D,F,V as L,v as T,D as U,S as M,I as q,W as B,L as I,X,K as E,Y as R,Z as G,M as H,a0 as O}from"./index-9136df32.js";const V=""+new URL("stylus-63009d3f.png",import.meta.url).href,P=""+new URL("circle-e8663312.png",import.meta.url).href,W=""+new URL("star-9d3daf5f.jpg",import.meta.url).href;let Y=null;function z(){const l=n(t("isLyric")||!1),f=n([]),m=n(""),g=n([]),d=n(0),v=n(0),C=n(14),{currentSong:p,currentTime:y}=a(e());async function h(){if(console.log(333),!p.value.name)return;g.value=[];let e=t("SONGS");if(!e||!e.length)return;const a=c(p.value.name);let l=e.find((e=>`${a}.lrc`.toLowerCase()===e.name.toLowerCase())),n="";if(l){const{data:e}=await i(l);if(!e.raw_url)return;n=await r(`${l.path}/${l.name}`,{sign:e.sign,alist_ts:Date.now()})||""}else{let e=await o({url:`https://api.lrc.cx/jsonapi?title=${a}&album=&artist=`,noToken:!0});if(console.log("lyricRes",e),e&&e.length&&a===c(p.value.name)){e=e.filter((e=>e.lyrics&&e.lyrics.trim())),n=e[0].lyrics||"";let l=t("lyricTemp")||{};if(l[a]){const t=e.find((e=>e.id===l[a]));t&&(n=t.lyrics)}g.value=e}}a===c(p.value.name)&&w(n)}function w(e){m.value=e;let a=e.split(/\r?\n|\r/);if(!a.length)return;f.value=[];const l=/^\[(\d{2}:\d{2}\.\d{1,})\]\s*(.*)$/;a.forEach((e=>{const a=l.exec(e);if(a){const e=a[2];if(!e)return;f.value.push({time:a[1],content:e})}}))}return s(p,(()=>{Y&&(clearTimeout(Y),Y=null),Y=setTimeout((()=>h()),200)}),{immediate:!0}),s(y,(()=>function(){const e=A().windowWidth>A().windowHeight?5:6;0===y.value&&(v.value=0,d.value=0);const a=16+1.1*C.value,l=d.value=function(){let e=0;return f.value.forEach(((a,l)=>{const n=f.value&&f.value[l].time,t=60*Number(n.split(":")[0])+Number(n.split(":")[1])+Number(n.split(".")[1])/1e3;y.value>=t&&(e=l)})),e}(),n=l*a+30;l>e&&(v.value=n-e*a)}())),s(l,(()=>u("isLyric",l.value))),{isLyric:l,lyricList:f,currentLyricIndex:d,scrollTop:v,remoteLyrics:g,lyricText:m,setSize:function(e){C.value=e},setLyricList:w,setLyricTemp:function(e,a){let l=t("lyricTemp")||{};l[e]=a,u("lyricTemp",l)},fetchLyric:h}}const Z=m({__name:"index",setup(s){const o=e(),i=z(),{togglePlay:r,onPrev:A,onNext:m,changePlayMode:Y,fetchSongUrl:Z}=o,{currentSong:J,playing:j,currentTime:_,modeIcon:$,currUrl:ee}=a(o),{progress:ae,onChanging:le,onChange:ne}=function(){const n=e(),{audio:t}=n,{currentSong:s,currentTime:c,progressDragging:o}=a(n);function i(e){const a=e/100,l=s.value.dt/1e3;c.value=a*l}return{progress:l((()=>{const e=s.value.dt/1e3,a=c.value/e;return Number.parseFloat((100*a).toFixed(1))})),onChanging:function(e){o.value=!0,i(e.detail.value)},onChange:function(e){o.value=!1,i(e.detail.value),t.pause(),t.seek(c.value),setTimeout((()=>{t.play()}),100)}}}(),{isLyric:te,setSize:se,setLyricList:ce,setLyricTemp:oe,fetchLyric:ie}=i,{remoteLyrics:re,lyricText:ue,lyricList:Ae,scrollTop:fe,currentLyricIndex:me}=a(i),ge=n(0),de=n(!1),ve=n(!1),Ce=n(t("lyricFontSize")||14),pe=n(t("syncLyric")||!1);se(Ce.value);const ye=l((()=>(J.value.name||"").split(".")[0])),he=l((()=>re.value.map((e=>({...e,name:`${e.title}-${e.artist}-${e.album}`})))));async function we(){const{confirm:e}=await U({content:"确定要上传并覆盖歌词吗？"});if(!e)return;const a=M.baseApi+"/api/fs/form",l=`${c(J.value.name)}.lrc`,n=`${J.value.path}/${l}`,s={Authorization:t("SESSION-TOKEN"),"File-Path":encodeURIComponent(n),"As-Task":"true"};console.log(a,s,n),function(e,a,l="file.txt",n,t){const s=`----WebKitFormBoundary${Date.now()}${Math.random().toString(36).substring(2)}`;let c=`--${s}\r\n`;c+=`Content-Disposition: form-data; name="file"; filename="${l}"\r\n`,c+="Content-Type: text/plain\r\n\r\n",c+=a,c+=`\r\n--${s}--`,f({url:e,method:"PUT",header:{...n,"Content-Type":`multipart/form-data; boundary=${s}`},data:c,success:e=>{console.log("文件上传成功",e),t&&t(e)},fail:e=>{console.log("上传失败",e)}})}(a,ue.value,l,s,(e=>{200==e.data.code&&q({title:"上传成功",icon:"none"})}))}function ke(e){Ce.value+=e?1:-1,se(Ce.value),u("lyricFontSize",Ce.value)}function Se(){if(!ee.value)return q({title:"暂无播放链接, 请先播放歌曲",icon:"none"});B({data:ee.value,success(){q({title:"复制链接成功",icon:"none"})}})}function be(e){const a=e.detail.value;ce(he.value[a].lyrics),q({title:"切换歌词成功",icon:"none"}),oe(ye.value,he.value[a].id)}return g((()=>d("tabClick"))),(e,a)=>{const l=w,n=I,t=X,s=E,c=R,o=G,i=H("curr-play-list");return v(),C(l,{class:y(["wh-full pts",{"full-screen":h(de)}])},{default:p((()=>[k(l,{class:"title-wrap"},{default:p((()=>[k(l,{class:"music-title",onClick:a[0]||(a[0]=a=>e.$copy(h(ye),"复制成功"))},{default:p((()=>[S(b(h(ye)),1)])),_:1}),k(l,{class:"music-path"},{default:p((()=>[S(b(h(J).path),1)])),_:1})])),_:1}),N(" 旋转的光盘 "),x(k(l,{class:"fade-in w-full flex-1 flex-center"},{default:p((()=>[k(l,{class:"music-pic"},{default:p((()=>[k(l,{class:y(["music-point",{stop:!h(j)}])},{default:p((()=>[k(n,{class:"wh-full",src:V})])),_:1},8,["class"]),k(l,{class:y(["wh-full relative rotate-start",{"rotate-paused":!h(j)}]),onClick:a[1]||(a[1]=e=>te.value=!0)},{default:p((()=>[k(n,{class:"wh-full music-img-bg",src:P}),k(n,{class:"music-img",src:W})])),_:1},8,["class"])])),_:1})])),_:1},512),[[Q,!h(te)]]),N(" 歌词 "),x(k(t,{"scroll-y":"","scroll-with-animation":"","scroll-top":h(fe),class:y(["fade-in flex-1 lyric-box",h(te)?"opacity-100":"opacity-0"]),onClick:a[2]||(a[2]=e=>te.value=!1)},{default:p((()=>[h(Ae)&&h(Ae).length?(v(),C(l,{key:0,class:"pb-50%"},{default:p((()=>[(v(!0),K(F,null,D(h(Ae),((e,a)=>(v(),C(l,{key:e.time,style:O({fontSize:h(Ce)+"px"}),class:y([{on:a===h(me)},"text-center lyric-item"])},{default:p((()=>[S(b(e.content),1)])),_:2},1032,["style","class"])))),128))])),_:1})):(v(),C(l,{key:1,class:"h-full flex-center text-sm text-light"},{default:p((()=>[S(" 暂无歌词 ")])),_:1}))])),_:1},8,["scroll-top","class"]),[[Q,h(te)]]),k(l,{class:"lyric-control"},{default:p((()=>[k(s,{class:"iconfont icon-custom icon-add",onClick:a[3]||(a[3]=e=>ke(!0))}),k(s,{class:"iconfont icon-custom icon-minus",onClick:a[4]||(a[4]=e=>ke(!1))}),k(s,{class:"iconfont icon-custom icon-full",onClick:a[5]||(a[5]=e=>de.value=!h(de))}),k(s,{class:"iconfont",onClick:h(ie)},{default:p((()=>[k(n,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABDlJREFUeF7tm21u2zAMhk0791h6g6LO/7UnaXOSNSdZepKl/+OiN6h3j7gcGEgGzUrWh2XPRh2gWIcqMvnwpSRLFGTf/APf3P9sBTC2Am5vb7d5nt/neb5FxJ/qedssy+hHf2r1C/1bI+Jrnuf1+Xw+jW3fKAogpzebzRMi/hrogAby8vb2dhzYl/HryQAwpx9FdPmDrw6pnwwA/iLiD6YK+vXe4ih97wQALymVkQTAbrd7tkS7JoPJ8BCjddoAAKXMkwHIsWmaw/v7u06daHEMArDb7e4R8bfMZ3L6crkcUxjIYJCyuDqucM/n83O091kWPwuUZUmO8+gkMajPGYJRFAWNK53nNk3zEAs7WAHKCHK+jQYAHIZGIiSKBhuc8LVaEfHAB9QgAKqTP3z6GkI/xGnZ1jTT9AWiLEuym4J2qqrqQffnDcDgfKejIc4M+a5hHDpWVbWXfQ4CIJ2fWvIuQColKMJ6cfUFQjQA1fmHNgIR92MtSlyOegyQLQQZpGgAZVlimy8TD3ahQKQSOIQoAOxLZIsxt0KNHLu9UCzNDntahAUDEHk/iwHPF97d3d0TANBUTZ+6qqqbYABC+g8hS1lfQ8dsx5fnlArqTdRvGuSrvLmN+L7QxHig3xlolnCvA1j0FyV9CUekgv5zPwAR/cVJn0MwLdudCmDRvw4evpKbup1aCvNdJZsJ9MbKN2bsCuCSmeuCh7y0SNs3BnYAbA6dde4PBNBZz3i/DPninaqd3igJeR5tzMrX9sUCCHG8r+0KIBXJpfazKmCpkUtl96qAVCSX2s+qgKVGLpXdqwJSkVxqP6sClhq5VHavCpBbSFTa8vn5GVR4MFU9T6qo8346CjCc+Xs/c847SOSEOhfY6oMS7ZgEoI+QvR3XDecMoG+rrxcAnQnQLqqLxuVyqWMrNFx9p/h7WZZ0uHvdQK2qquOzSwGz3hn2gSP2D7+cb7oAZHOWtg8AfsDbNM2NVKoNAM0Ces99sSoQ5XvG020bgBMivrAT1kUcjcspvSiKtrBD5r5rFjg1TbMviqKtBltaKnDpA4D1iM+qAKqkksUG/6sizCfXeRuxnuk95OkFQJ3KYoO5QxB57xy/nAAIgux0rhDkkVmf9J1jAC8mNBQl1nODIAu2fZwnCF4KoIYmCCmKlUPz29ReFHNRGb53XYMNgHXaM5CetE7YMNXxuuW2KswXbAeAyqFHVRdkfQcw3A8IfrCvgaZ2lhspUWkZvSFiKE8lW6/rhzFfjCyXM6LrGaIBWMYFHTC6+NQpSx8h4tTlYOUNAqCd6rkkdb3nE3oLjNX/UH0PXZuR94ic9wN8gScBwEEYbnRwW9oLUz0Xp+SVus73U888SQFwEHRXEADkPR/fwHxxOtUdJGnAKADkVEX/V0BIzjrCssStvTwJAK+0MTtFWf7oAGJCPuV3VgBT0p7js/4BvmzGX75mNWwAAAAASUVORK5CYII="})])),_:1},8,["onClick"]),k(c,{onChange:be,value:h(ge),range:h(he),"range-key":"name"},{default:p((()=>[x(k(s,{class:"iconfont"},{default:p((()=>[S("↹")])),_:1},512),[[Q,h(he)&&h(he).length]])])),_:1},8,["value","range"]),x(k(s,{class:"iconfont",onClick:we},{default:p((()=>[k(n,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABO5JREFUeF7tmk1y0zAUgJ+UToFDMKRngEXiaYO74wqs2hyBE7Q5Bcu2K9acoCZlkixgpjfADIcAOq3EyKlb+/npx5Zsl0m668S29L739H7FYMP/2IbLD1sAXVtAPBoNYQeGQvA4X1uCSAccUriFNFmt0i731IkFKKEF58cA8ggAhhYBUwB2wYU47wJGqwCU4JLzEwnyuIFWMxDzxeK0wbvOr7QGIN4fxUKwS+ed6B9sFUQrAN5G0ZlF65lQucwM4JWQcsgYPPiFKg82a8MaggMwCG/VpDoydxxiBuyE9hXhIQQFMImiUwCpNo/+6m284DS9v2U7gsEAaM58yrmcJl9XiW0j1O9rEJkfKUYOr29WVNNkY9Q7B+PxJTrDQTZ6D+EHWjOdL5Z7IfYexAIOotExA3ZW3BDn8rCp5rFgbX4/DACkfQbs/MtiMQ2hofwbhHMNYgXeACgT5ULuhc7iyHUCWJk3AGyebWg/t4Kqn6kXXSiL9AKQpboD9lFKePf4cfYZAK5VgXO1WJ2HPAZVX8CuORcffIqo2gDMMbosbmhr0ESEbFEpIRkM5KwuDGcADQubII4qx2oCkD+Tg3CNQE4AqDDkYtqhLUCtOYnG0mVtADZzKamtACyFTSolpJyxVAL8LG6sDR+gAaAaKGSPIbMGKaemiGQEQGR3uYypBDkL7eRcNIstYL5YMpWGS8GPNBVoyoU81EHQAtCZfcgMz0XgSlZYSLqUhq+Wy8MHH7HuQaiMFFmEPlySANoobJoISxZI+6P47o6dMAZDXaFFWy4NgQRAfaBvzdcFOInGqoAqWQKVoVYAUNr/34RXsOhSumoFFQDY6+NzVlcTfT5PNGgqeUkFADad/1H7KHEqNVTwMSgBoDItFWba0GKeUmdDEQFJ6OpRV0BJkNNi+C4J11VlR/iZIN0jSlH4GODstHMAhnlBKxBsSi0BqDoN/3q7qBWHYUlwCHhN7NQ7swAH4R/SbJ9OciVzRP1KIwAbrabOsIbwwSHYrNoWBbzr+QbCB4Vga6NVQhx+wScP0AmvQhFuo6v6nZgqefkEl4YtkQiVx1tNM0GT8CoOU2WtZrTWGEKjTDBE+1nXuiomIRSAdcODnC8aa3qyalyP1dBEyaEWUB8jx1yGpoLN86rfcQamA6CDgN+3OWRKBmqcRvcDSHrgrIVKNEHpJ9Xawik3toQ6vsi7H5BZATHvAwDrjL/cneEx5yKhOrQmCygWM+q+gGutkN0vYOwMX7Qw+TFjoaOf90Njx5QL5wLAZuZF2KaeoGmSbATgMARJGbBs9o+7wvnmdN1hFwBrK+Rkx1ddq7n3LepajbYrXOwZUkCdSl2DJTgpiZoP2AD4rukavp0A5C0mnytv2AztAKo9PRfarUyGShXd490/renhjTaxAIebZqVl1BqMiwvXkVj+srMF6JIN5aXVb7qz6uMD1uH08UptcQ/qu+p/1wihsx4vAC4mqXvGdgR8vl3n3S2AOrRCPru1ADTmbqv7bFNan0egOLrybrzYBH1yTrAc5sI2X+vA6M0CsuRqf5SF0Lqxu46Atmd7BWDbXBe/bwF0QZlaYzKZvGS3N++zim5n99N8Pv/Vx156s4DJePwNGLzOhJbwfb5cvtkYAHEcPxc3f38XBea7z14kSfKnawhbC+iaeL7exvuAvsDjdXs7AlsAT4TAPySSmm4uutnkAAAAAElFTkSuQmCC"})])),_:1},512),[[Q,h(pe)&&h(he)&&h(he).length]])])),_:1}),k(l,{class:"w-full music-btm"},{default:p((()=>[N(" 进度条 "),k(l,{class:"flex-center"},{default:p((()=>[k(l,null,{default:p((()=>[S(b(h(L)(h(_))),1)])),_:1}),k(l,{class:"flex-1"},{default:p((()=>[k(o,{class:"m0","background-color":"rgba(0, 0, 0, 0.3)","active-color":"var(--color-base)","block-size":12,value:h(ae),onChange:h(ne),onChanging:h(le)},null,8,["value","onChange","onChanging"])])),_:1}),k(l,{class:"w-10 text-right"},{default:p((()=>[S(b(h(L)(h(J).dt/1e3)),1)])),_:1})])),_:1}),N(" 歌曲操作栏 "),k(l,{class:"flex ai-c jc-sa music-control"},{default:p((()=>[k(s,{class:y(["iconfont",h($)]),onClick:h(Y)},null,8,["class","onClick"]),k(s,{class:"iconfont icon-prev",onClick:h(A)},null,8,["onClick"]),k(s,{class:y(["iconfont",h(j)?"icon-pause":"icon-play"]),onClick:h(r)},null,8,["class","onClick"]),k(s,{class:"iconfont icon-next",onClick:h(m)},null,8,["onClick"]),k(s,{class:"iconfont icon-playlist",onClick:a[6]||(a[6]=e=>ve.value=!0)}),k(s,{class:"iconfont",onClick:Se},{default:p((()=>[S("♬")])),_:1})])),_:1})])),_:1}),k(i,{modelValue:h(ve),"onUpdate:modelValue":a[7]||(a[7]=e=>T(ve)?ve.value=e:null)},null,8,["modelValue"])])),_:1},8,["class"])}}},[["__scopeId","data-v-15245671"]]);export{Z as default};
